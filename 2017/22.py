lines = """.##..#.#.##...#....#..###
####.#...###.####..#.....
#.#.#####....######.###.#
#.#..###.#.#####....#..#.
####.#.#...#.##.##..#.###
#.####..#####.#.#....#.##
.#.####.#....###..##....#
..##.#..##.#.#.###.##.#..
##....#....######.###.###
.#.##.###.###.###.#..#.#.
#.##.#.#..#.#.....###....
####.....#..###..##..##..
##....#.#...####...#.#.#.
...#.##..###..##..#......
#....#..##.##.#..#.###..#
...#...##.##.##...#.#.#..
.##....#.####.#..##.#...#
#.######......#.#...#.##.
#.##....###...###.###....
#..#.#.#.#.#..#.#.....#..
...##..##.###....#.###...
.######.#...###.###.#.#.#
####..###.####...#..#####
.##.#.##...##..##...#.#.#
###...##..#..##.##..#..#.""".split('\n')

field = {}
o = len(lines) // 2
for (y, l) in enumerate(lines):
  for (x, c) in enumerate(l):
    field[(x-o, o-y)] = 2 if c == '#' else 0

print(field)
def rot(d, state):
  x, y = d
  if state == 0:
    return (-y, x)
  elif state == 1:
    return (x, y)
  elif state == 2:
    return (y, -x)
  elif state == 3:
    return (-x, -y)

def add(a, b):
  return (a[0] + b[0], a[1] + b[1])

pos = (0, 0)
dir = (0, 1)

c = 0
for _ in range(10000000):
  v = field.get(pos, 0)
  dir = rot(dir, v)
  v = (v + 1) % 4
  if v == 2: c += 1
  field[pos] = v
  pos = add(pos, dir)
print(c)
